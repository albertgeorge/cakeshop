{% load url from future %}
<!DOCTYPE html>
<html>
	<head>
		<title>Cakeshop admin</title>
		<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}styles/primary.css" />
		<script type="text/javascript" src="{{ STATIC_URL }}scripts/jquery-1.8.2.min.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL }}scripts/jquery.lightbox_me.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL }}scripts/jquery.ambiance.js"></script>
		<script type="text/javascript">
			var categories;
			
			$(document).ajaxSend(function(event, xhr, settings) {
			    function getCookie(name) {
			        var cookieValue = null;
			        if (document.cookie && document.cookie != '') {
			            var cookies = document.cookie.split(';');
			            for (var i = 0; i < cookies.length; i++) {
			                var cookie = jQuery.trim(cookies[i]);
			                // Does this cookie string begin with the name we want?
			                if (cookie.substring(0, name.length + 1) == (name + '=')) {
			                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
			                    break;
			                }
			            }
			        }
			        return cookieValue;
			    }
			    function sameOrigin(url) {
			        // url could be relative or scheme relative or absolute
			        var host = document.location.host; // host + port
			        var protocol = document.location.protocol;
			        var sr_origin = '//' + host;
			        var origin = protocol + sr_origin;
			        // Allow absolute or scheme relative URLs to same origin
			        return (url == origin || url.slice(0, origin.length + 1) == origin + '/') ||
			            (url == sr_origin || url.slice(0, sr_origin.length + 1) == sr_origin + '/') ||
			            // or any other URL that isn't scheme relative or absolute i.e relative.
			            !(/^(\/\/|http:|https:).*/.test(url));
			    }
			    function safeMethod(method) {
			        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
			    }
			
			    if (!safeMethod(settings.type) && sameOrigin(settings.url)) {
			        xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
			    }
			});
			
			$(document).ready(function(){				
				wireevents();
				onload();
			});
			
			var onload = function()
			{
				$("#createitem").hide();
				$("#createcategory").hide();
				$.get('{% url 'cakeshop.apps.admin.views.categories.get_categories' %}',function(data,status,xhr)
				{
					if(data.length > 0)
					{
						var options = []
						$.each(data, function(key,value){
							options.push('<option value="'+ value.id +'">'+ value.name +'</option>');
						});
						$('#categorycombobox').html(options.join(''));
					}
				});
			}
			
			var wireevents = function()
			{
				$("#create").click(function(){
					$("#createitem").show();
					$("#createitem").lightbox_me({
        					centered: true});
				});
				$("#categoryadd").click(function(){
					$("#createcategory").show();
					$("#createcategory").lightbox_me({
        					centered: true});					
				});
				$("#addcategorybutton").click(function(){
					$.post('{% url 'cakeshop.apps.admin.views.categories.add_category' %}',{name:$("#categoryinputbox").val()},function(result){
						if(result == "True")
						{
							$.ambiance({
								message: "The category has been successfully added.", 
					            title: "Success!",
					            type: "error"});
						}
						else
						{
							$.ambiance({
								message: "Error adding the category", 
					            title: "Error",
					            type: "error"});
						}
					});
				});
			}
			
		</script>
	</head>
	<body>
		 {% csrf_token %}
		<div id="container">
			<div id="welcome">
				{% block headercontent %}
					{% if user.is_authenticated %}
						<div>Hi {{ user.first_name }} | <a href="{% url 'cakeshop.apps.admin.views.logoutuser' %}">Log Out</a></div>
					{% endif %}
				{% endblock %}
			</div>
			<div id="logo">
				Cakeshop admin
			</div>
			<div id="nav">
				<ul>
				 	<li><a href="#">Home</a></li>
				 	<li>				 
				  		<a href="#">Item</a>				  
				  		<ul>				  
				   			<li><a id="create" href="#">Create</a></li>
						   	<li><a href="#">Search</a></li>	
						   	<li><a id="categoryadd" href="#">Add Category</a></li>
				  		</ul>				 
				 	</li>		
				</ul>
			</div>
			<div id="bodycontent">
				{% block bodycontent %}
				{% endblock %}
			</div>
			<div id="createitem">
				Category <select id="categorycombobox"></select>
			</div>
			<div id="createcategory">
				Category <input type="text" id="categoryinputbox" />
				<input type="button" id="addcategorybutton" value="Add"/>
			</div>
		</div>
	</body>
</html>
